<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø´ÙŠØ® Ø§Ù„ÙƒØ§Ø± - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <style>
        :root { --p: #1b4332; --cash: #27ae60; --card: #2980b9; --danger: #e74c3c; --warn: #f39c12; --end: #2c3e50; }
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 0; direction: rtl; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); z-index: 2000; display: flex; align-items: center; justify-content: center; color: white; }
        .login-box { background: white; color: #333; padding: 30px; border-radius: 15px; width: 320px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        #main-system { display: none; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 380px; gap: 20px; max-width: 1300px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        header { background: var(--p); color: white; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; position: relative; }
        .logout-btn { position: absolute; left: 15px; top: 15px; background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        #sidebar { position: fixed; right: -320px; top: 0; width: 280px; height: 100%; background: white; z-index: 1000; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: 0.3s; overflow-y: auto; border-left: 5px solid var(--p); }
        #sidebar.open { right: 0; }
        .close-sidebar { background: var(--danger); color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; float: left; font-weight: bold; }
        .p-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto; }
        .p-btn { border: 2px solid var(--p); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; font-weight: bold; background: white; transition: 0.2s; }
        .p-btn:hover { background: var(--p); color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        .row-ex { color: var(--danger); font-weight: bold; }
        .btn-pay { border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .stat-item { padding: 10px; border-radius: 8px; color: white; text-align: center; font-weight: bold; margin-bottom: 5px; }
        .top-btn { background: var(--p); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; font-weight: bold; }
        .locked-input { background: #f0f0f0; color: #777; cursor: not-allowed; border: 1px solid #ccc; }
        .start-box { background: #e8f4fd; border: 1px solid #3498db; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="margin-top:0; color:var(--p)">Ù†Ø¸Ø§Ù… Ø´ÙŠØ® Ø§Ù„ÙƒØ§Ø±</h2>
        <select id="user-select">
            <option value="Ø§Ù„Ù…Ø¯ÙŠØ±">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</option>
            <option value="Ø¹Ø²Ø§Ù…">Ø¹Ø²Ø§Ù…</option>
            <option value="ÙŠØ­ÙŠÙ‰">ÙŠØ­ÙŠÙ‰</option>
        </select>
        <input type="password" id="user-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button onclick="login()" style="width:100%; padding:12px; background:var(--cash); color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="main-system">
    <button class="top-btn" onclick="toggleSidebar()">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¬Ø±Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</button>

    <div id="sidebar">
        <button class="close-sidebar" onclick="toggleSidebar()">Ø¥ØºÙ„Ø§Ù‚ X</button>
        <div style="clear: both; padding-top: 20px;"></div>
        
        <h3>ğŸ“… ØªØºÙŠÙŠØ± ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„</h3>
        <input type="date" id="hist-date" onchange="loadDate()">
        <hr>

        <h3>ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ø´Ù‡Ø± (Ù„Ù„Ù…Ø¯ÙŠØ±)</h3>
        <button onclick="calcMonth()" style="width:100%; background:var(--card); color:white; border:none; padding:10px; border-radius:5px; cursor:pointer;">ØµØ§ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
        <div id="month-result" style="display:none; padding:10px; background:#f9f9f9; margin-top:5px; border-radius:5px; border:1px solid #ddd;"></div>
        <hr>

        <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
        <input type="text" id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input type="number" id="pp" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <button onclick="addP()" style="width:100%; background:var(--p); color:white; border:none; padding:10px; border-radius:5px;">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
        <hr>

        <button style="background:#fee2e2; color:#b91c1c; border:1px solid #f87171; padding:10px; width:100%; border-radius:5px; cursor:pointer;" onclick="clearSystemWithPass()">ØªØµÙÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ø¸Ø§Ù…</button>
    </div>

    <header>
        <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬ â†©</button>
        <h2 id="emp-name" style="margin:0; font-size:1.1rem;">--</h2>
        <h1 id="full-date" style="margin:5px 0">18-01-2024</h1>
    </header>

    <div class="grid">
        <div>
            <div class="card">
                <h3>ğŸ›ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                <div id="p-list" class="p-grid"></div>
            </div>
            <div class="card">
                <h3>ğŸ—’ï¸ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª <span id="closed-label" style="color:red; font-weight:bold;"></span></h3>
                <table>
                    <thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="log-body"></tbody>
                </table>
            </div>
        </div>

        <div>
            <div class="card">
                <div id="start-balance-section" class="start-box">
                    <h3 style="margin-top:0; color:#2980b9;">ğŸ’° Ø±ØµÙŠØ¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</h3>
                    <label>ÙƒØ§Ø´ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
                    <input type="number" id="scash" placeholder="0.00">
                    <label>Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
                    <input type="number" id="scard" placeholder="0.00">
                    <button id="save-start-btn" onclick="saveStartBalance()" style="width:100%; background:#3498db; color:white; border:none; padding:10px; border-radius:5px; font-weight:bold; cursor:pointer;">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ­ÙØ¸ Ø§Ù„Ø±ØµÙŠØ¯</button>
                </div>

                <div id="sales-section" style="display:none;">
                    <h3>ğŸ›’ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
                    <div id="cart-items" style="min-height:50px; border-bottom:1px solid #eee; margin-bottom:10px;"></div>
                    
                    <label>Ø®ØµÙ… (Ø±ÙŠØ§Ù„):</label>
                    <input type="number" id="discount" value="0" oninput="upCart()">
                    
                    <h2 style="text-align:center; color:var(--danger); background:#fff5f5; padding:10px; border-radius:8px;">Ø§Ù„ØµØ§ÙÙŠ: <span id="net-total">0</span></h2>
                    
                    <button class="btn-pay" style="background:var(--cash)" onclick="pay('ÙƒØ§Ø´')">Ø¯ÙØ¹ ÙƒØ§Ø´ ğŸ’µ</button>
                    <button class="btn-pay" style="background:var(--card)" onclick="pay('Ø´Ø¨ÙƒØ©')">Ø¯ÙØ¹ Ø´Ø¨ÙƒØ© ğŸ’³</button>
                    
                    <div style="border-top:2px solid #eee; margin-top:20px; padding-top:10px;">
                        <h3>ğŸ’¸ ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ</h3>
                        <input type="text" id="ed" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ù…ØµØ±Ù">
                        <input type="number" id="ea" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                        <select id="em"><option value="ÙƒØ§Ø´">Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙƒØ§Ø´</option><option value="Ø´Ø¨ÙƒØ©">Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ©</option></select>
                        <button class="btn-pay" style="background:var(--danger)" onclick="addEx()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“Š Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ÙŠÙˆÙ…</h3>
                <div class="stat-item" style="background:var(--cash)">ÙƒØ§Ø´: <span id="ncash">0</span></div>
                <div class="stat-item" style="background:var(--card)">Ø´Ø¨ÙƒØ©: <span id="ncard">0</span></div>
                <button id="end-btn" style="background:var(--end); color:white; border:none; padding:15px; border-radius:8px; cursor:pointer; width:100%; font-weight:bold; margin-top:10px;" onclick="archiveDay()">ğŸš© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… ÙˆØ£Ø±Ø´ÙØ© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</button>
            </div>
        </div>
    </div>
</div>

<script>
    const users = { "Ø§Ù„Ù…Ø¯ÙŠØ±": "12344", "Ø¹Ø²Ø§Ù…": "1234", "ÙŠØ­ÙŠÙ‰": "9999" };
    let currentUser = "";
    let cart = []; 
    let vDate = localStorage.getItem('current_work_date') || "2024-01-18"; 

    function login() {
        let u = document.getElementById('user-select').value;
        let p = document.getElementById('user-pass').value;
        if(users[u] === p) {
            currentUser = u;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-system').style.display = 'block';
            document.getElementById('emp-name').innerText = "Ø§Ù„Ù…ÙˆØ¸Ù: " + currentUser;
            renderP();
            refresh();
        } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£!"); }
    }

    function saveStartBalance() {
        if(confirm("Ø³ÙŠØªÙ… Ù‚ÙÙ„ Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¢Ù†ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
            let c = { scash: parseFloat(document.getElementById('scash').value)||0, scard: parseFloat(document.getElementById('scard').value)||0, locked: true };
            localStorage.setItem('conf_'+vDate, JSON.stringify(c));
            refresh();
        }
    }

    function refresh() {
        let closed = localStorage.getItem('closed_'+vDate) === 'true';
        let conf = JSON.parse(localStorage.getItem('conf_'+vDate)) || {scash:0, scard:0, locked:false};

        document.getElementById('full-date').innerText = vDate;
        document.getElementById('closed-label').innerText = closed ? "(Ù…Ø¤Ø±Ø´Ù)" : "";
        
        document.getElementById('scash').value = conf.scash;
        document.getElementById('scard').value = conf.scard;

        if(conf.locked || closed) {
            document.getElementById('scash').disabled = true;
            document.getElementById('scard').disabled = true;
            document.getElementById('save-start-btn').style.display = 'none';
            document.getElementById('sales-section').style.display = closed ? 'none' : 'block';
        } else {
            document.getElementById('scash').disabled = false;
            document.getElementById('scard').disabled = false;
            document.getElementById('save-start-btn').style.display = 'block';
            document.getElementById('sales-section').style.display = 'none';
        }

        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        let h = ''; let s = { 'ÙƒØ§Ø´': conf.scash, 'Ø´Ø¨ÙƒØ©': conf.scard };
        
        db.forEach(op => {
            let cls = op.type === 'ex' ? 'class="row-ex"' : '';
            h += `<tr ${cls}><td>${op.emp}</td><td>${op.t}</td><td>${op.d}</td><td>${op.a}</td><td>${op.m}</td>
            <td>${closed ? '-' : `<button onclick="retItem(${op.id})">Ø­Ø°Ù</button>`}</td></tr>`;
            if(op.type==='sale') s[op.m]+=op.a; else s[op.m]-=op.a;
        });
        document.getElementById('log-body').innerHTML = h;
        document.getElementById('ncash').innerText = s['ÙƒØ§Ø´'].toFixed(2);
        document.getElementById('ncard').innerText = s['Ø´Ø¨ÙƒØ©'].toFixed(2);
        document.getElementById('end-btn').style.display = closed ? "none" : "block";
    }

    function pay(m) {
        if(cart.length===0) return;
        let disc = parseFloat(document.getElementById('discount').value) || 0;
        let total = cart.reduce((s,i)=>s+i.p,0);
        let finalA = total - disc;
        if(finalA < 0) finalA = 0;

        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        db.push({ emp: currentUser, id:Date.now(), t:new Date().toLocaleTimeString('ar-SA'), d:cart.map(c=>c.n).join(','), a:finalA, m:m, type:'sale' });
        localStorage.setItem('db_'+vDate, JSON.stringify(db));
        cart=[]; document.getElementById('discount').value=0; upCart(); refresh();
    }

    function addEx() {
        let d = document.getElementById('ed').value; 
        let a = parseFloat(document.getElementById('ea').value);
        let m = document.getElementById('em').value;
        if(!d || isNaN(a)) return;
        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        db.push({ emp: currentUser, id:Date.now(), t:new Date().toLocaleTimeString('ar-SA'), d:"Ù…ØµØ±ÙˆÙ: "+d, a:a, m:m, type:'ex' });
        localStorage.setItem('db_'+vDate, JSON.stringify(db));
        document.getElementById('ed').value=''; document.getElementById('ea').value=''; refresh();
    }

    function upCart() {
        let total = cart.reduce((s,i)=>s+i.p,0);
        let disc = parseFloat(document.getElementById('discount').value) || 0;
        document.getElementById('cart-items').innerHTML = cart.map(i => `<div style="padding:2px">â— ${i.n} (${i.p})</div>`).join('');
        document.getElementById('net-total').innerText = (total - disc).toFixed(2);
    }

    function addToCart(n,p) { 
        if(localStorage.getItem('closed_'+vDate)==='true') return; 
        cart.push({n,p}); 
        upCart(); 
    }

    function renderP() {
        const baseP = [{n:"Ø¹Ù‚Ø§Ù„ Ù…Ø±Ø¹Ø²",p:65},{n:"Ø¹Ù‚Ø§Ù„ Ø§ÙƒØ±Ù„ÙŠÙƒ",p:100},{n:"Ø¹Ù‚Ø§Ù„ Ù…Ù„ÙƒÙŠ",p:100},{n:"Ø¹Ù‚Ø§Ù„ ØµÙˆÙ",p:50},{n:"Ø¹Ù‚Ø§Ù„ ØªÙØµÙŠÙ„",p:150},{n:"Ø¹Ù‚Ø§Ù„ ØªÙØµÙŠÙ„ Ù…Ø¬Ø¯ÙˆÙ„",p:250},{n:"Ø®ÙŠØ§Ø·Ø© Ø¹Ù‚Ø§Ù„",p:20},{n:"ØªÙ„Ù…ÙŠØ¹ Ø¹Ù‚Ø§Ù„",p:10},{n:"ÙØ±ÙˆØ© Ø±Ø¬Ø§Ù„ÙŠ",p:100},{n:"ÙØ±ÙˆØ© Ø¨Ø®ÙŠØ§",p:120},{n:"ÙØ±ÙˆØ© Ù†Ø³Ø§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯Ø©",p:130},{n:"Ù‚Ø±ÙˆØ© Ø´Ø¨Ø§Ø¨ÙŠ",p:50},{n:"Ø·Ø§Ø¨Ù‚Ø©",p:10},{n:"Ø·Ø§ÙŠÙ‚Ø© Ø¬Ø²Ø§Ø¦Ø±ÙŠ",p:30},{n:"ØµØ¯Ø±ÙŠØ© Ø±Ø¬Ø§Ù„ÙŠ",p:100},{n:"Ø­Ø¯ÙŠØ§Ù†",p:50},{n:"Ø¨Ø¬Ø§Ù…Ø© Ø±Ø¬Ø§Ù„ÙŠ ÙØ±ÙˆØ©",p:55},{n:"Ø¨Ø¬Ø§Ù…Ø© Ø±Ø¬Ø§Ù„ÙŠ Ø¨Ø¯ÙˆÙ† ÙØ±ÙˆØ©",p:45},{n:"Ø¨Ø¬Ø§Ù…Ø© Ø§Ø·ÙØ§Ù„",p:45},{n:"ÙØ§Ø¦ÙŠÙ„Ø© Ø±Ø¬Ø§Ù„ÙŠ",p:15},{n:"Ø³Ø±ÙˆØ§Ù„ Ø·ÙˆÙŠÙ„",p:20},{n:"Ø·Ù‚Ù… Ù‡Ø¯ÙŠØ©",p:600},{n:"Ù…Ø´Ù„Ø­ Ø´ØªÙˆÙŠ",p:350},{n:"Ù…Ø´Ù„Ø­ ØµÙŠÙÙŠ",p:250},{n:"ØµØ¯Ø±ÙŠØ© Ø´Ø¨Ø§Ø¨ÙŠ",p:50}];
        let custom = JSON.parse(localStorage.getItem('custom_p')) || [];
        document.getElementById('p-list').innerHTML = [...baseP, ...custom].map(x => `<div class="p-btn" onclick="addToCart('${x.n}',${x.p})">${x.n}<br>${x.p} Ø±ÙŠØ§Ù„</div>`).join('');
    }

    function calcMonth() {
        if(currentUser !== "Ø§Ù„Ù…Ø¯ÙŠØ±") return alert("Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·!");
        let month = vDate.substring(0, 7); let tCash = 0; let tCard = 0;
        for (let i = 0; i < localStorage.length; i++) {
            let key = localStorage.key(i);
            if (key.startsWith('db_') && key.includes(month)) {
                let db = JSON.parse(localStorage.getItem(key));
                db.forEach(op => { if(op.type==='sale') { if(op.m==='ÙƒØ§Ø´') tCash+=op.a; else tCard+=op.a; } else { if(op.m==='ÙƒØ§Ø´') tCash-=op.a; else tCard-=op.a; } });
            }
        }
        let res = document.getElementById('month-result'); res.style.display = 'block';
        res.innerHTML = `<strong>Ø¬Ø±Ø¯ Ø´Ù‡Ø± (${month}):</strong><br>ğŸ’µ ÙƒØ§Ø´: ${tCash.toFixed(2)}<br>ğŸ’³ Ø´Ø¨ÙƒØ©: ${tCard.toFixed(2)}`;
    }

    function logout() { currentUser = ""; document.getElementById('login-screen').style.display = 'flex'; document.getElementById('main-system').style.display = 'none'; }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function loadDate() { 
        vDate = document.getElementById('hist-date').value; 
        localStorage.setItem('current_work_date', vDate);
        refresh(); 
    }
    function archiveDay() { if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©ØŸ")) { localStorage.setItem('closed_'+vDate, 'true'); refresh(); } }
    function retItem(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ")) { let db = JSON.parse(localStorage.getItem('db_'+vDate)) || []; db = db.filter(x=>x.id!==id); localStorage.setItem('db_'+vDate, JSON.stringify(db)); refresh(); } }
    function clearSystemWithPass() { if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„ØªØµÙÙŠØ©:")==="12344") { localStorage.clear(); location.reload(); } }
    function addP() { let n=document.getElementById('pn').value; let p=document.getElementById('pp').value; if(n && p) { let c=JSON.parse(localStorage.getItem('custom_p'))||[]; c.push({n,p:parseFloat(p)}); localStorage.setItem('custom_p',JSON.stringify(c)); renderP(); } }
</script>
</body>
</html>
