<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø´ÙŠØ® Ø§Ù„ÙƒØ§Ø± - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <style>
        :root { --p: #1b4332; --cash: #27ae60; --card: #2980b9; --danger: #e74c3c; --warn: #f39c12; --end: #2c3e50; }
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 20px; direction: rtl; }
        .grid { display: grid; grid-template-columns: 1fr 380px; gap: 20px; max-width: 1300px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        header { background: var(--p); color: white; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        
        #sidebar { position: fixed; right: -320px; top: 0; width: 280px; height: 100%; background: white; z-index: 1000; padding: 20px; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: 0.3s; overflow-y: auto; border-left: 5px solid var(--p); }
        #sidebar.open { right: 0; }
        .close-sidebar { background: var(--danger); color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; float: left; font-weight: bold; }
        
        .p-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto; }
        .p-btn { border: 2px solid var(--p); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; font-weight: bold; background: white; transition: 0.2s; }
        .p-btn:hover { background: var(--p); color: white; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        .row-ret { background: #fee2e2; text-decoration: line-through; color: #999; }
        
        .btn-pay { border: none; padding: 12px; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        .stat-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { padding: 10px; border-radius: 8px; color: white; text-align: center; font-weight: bold; }
        .top-btn { background: var(--p); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; font-weight: bold; font-size: 1rem; }
        .end-btn { background: var(--end); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1.1rem; font-weight: bold; margin-top: 10px; }
        .archive-badge { background: #34495e; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; margin-right: 10px; }
        .month-stat { background: #f9f9f9; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<button class="top-btn" onclick="toggleSidebar()">âš™ï¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø¬Ø±Ø¯ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª)</button>

<div id="sidebar">
    <button class="close-sidebar" onclick="toggleSidebar()">Ø¥ØºÙ„Ø§Ù‚ X</button>
    <div style="clear: both; padding-top: 20px;"></div>
    
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
    <input type="text" id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="pp" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    <button onclick="addP()" style="width:100%; background:var(--p); color:white; border:none; padding:10px; border-radius:5px; cursor:pointer; font-weight:bold;">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    <hr>

    <h3>ğŸ“… Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
    <label>Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ø§Ù‹:</label>
    <input type="date" id="hist-date" onchange="loadDate()">
    <button onclick="goToday()" style="width:100%; margin-bottom:15px; cursor:pointer;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
    <hr>
    
    <h3>ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
    <button onclick="calcMonth()" style="width:100%; background:var(--card); color:white; border:none; padding:10px; border-radius:5px; cursor:pointer; font-weight:bold;">Ø­Ø³Ø§Ø¨ ØµØ§ÙÙŠ Ø§Ù„Ø´Ù‡Ø± ÙƒØ§Ù…Ù„Ø§Ù‹</button>
    <div id="month-result" class="month-stat" style="display:none;"></div>
    <hr>

    <h3>ğŸ’° Ø±ØµÙŠØ¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</h3>
    <label>ÙƒØ§Ø´ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
    <input type="number" id="scash" onchange="saveConf()">
    <label>Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
    <input type="number" id="scard" onchange="saveConf()">
    <hr>

    <button onclick="clearSystem()" style="background:#eee; color:#666; border:none; padding:5px; width:100%; border-radius:5px; cursor:pointer; font-size:10px;">ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
</div>

<header>
    <h2 id="day-name">--</h2>
    <h1 id="full-date">--</h1>
</header>

<div class="grid">
    <div>
        <div class="card" id="p-card">
            <h3>ğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
            <div id="p-list" class="p-grid"></div>
        </div>
        <div class="card">
            <h3>ğŸ—’ï¸ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª <span id="closed-label"></span></h3>
            <table>
                <thead>
                    <tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
                </thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
    </div>

    <div>
        <div class="card" id="cart-card">
            <h3>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h3>
            <div id="cart-items" style="min-height:50px; border-bottom:1px solid #eee;"></div>
            <h2 style="text-align:center">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0</span> Ø±ÙŠØ§Ù„</h2>
            <button class="btn-pay" style="background:var(--cash)" onclick="pay('ÙƒØ§Ø´')">Ø¯ÙØ¹ ÙƒØ§Ø´ ğŸ’µ</button>
            <button class="btn-pay" style="background:var(--card)" onclick="pay('Ø´Ø¨ÙƒØ©')">Ø¯ÙØ¹ Ø´Ø¨ÙƒØ© ğŸ’³</button>
            <button class="btn-pay" style="background:#8e44ad" onclick="pay('ØªØ­ÙˆÙŠÙ„')">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ ğŸ“±</button>
            <button onclick="cart=[];upCart();" style="width:100%; margin-top:10px; background:none; border:1px solid #ccc; cursor:pointer;">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
        </div>

        <div class="card" id="exp-card" style="background:#fff5f5">
            <h3>ğŸ’¸ ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ</h3>
            <input type="text" id="ed" placeholder="Ø³Ø¨Ø¨ Ø§Ù„ØµØ±Ù">
            <input type="number" id="ea" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
            <select id="em"><option value="ÙƒØ§Ø´">Ù…Ù† Ø§Ù„ÙƒØ§Ø´</option><option value="Ø´Ø¨ÙƒØ©">Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ©</option></select>
            <button class="btn-pay" style="background:var(--danger)" onclick="addEx()">Ø®ØµÙ… Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
        </div>

        <div class="card">
            <h3>ğŸ“Š Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ÙŠÙˆÙ…</h3>
            <div class="stat-box">
                <div class="stat-item" style="background:var(--cash)">ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´<br><span id="ncash">0</span></div>
                <div class="stat-item" style="background:var(--card)">ØµØ§ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©<br><span id="ncard">0</span></div>
            </div>
            
            <button id="end-btn" class="end-btn" onclick="archiveDay()">ğŸš© ØªØµÙÙŠØ± ÙˆØ¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… (Ø£Ø±Ø´ÙØ©)</button>
            <button onclick="window.print()" style="width:100%; margin-top:15px; cursor:pointer; background:none; border:1px solid #ccc; border-radius:5px; padding:5px;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
        </div>
    </div>
</div>

<script>
    // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const baseP = [{n:"Ø¹Ù‚Ø§Ù„ Ù…Ø±Ø¹Ø²",p:65},{n:"Ø¹Ù‚Ø§Ù„ Ø§ÙƒØ±Ù„ÙŠÙƒ",p:100},{n:"Ø¹Ù‚Ø§Ù„ Ù…Ù„ÙƒÙŠ",p:100},{n:"Ø¹Ù‚Ø§Ù„ ØµÙˆÙ",p:50},{n:"Ø¹Ù‚Ø§Ù„ ØªÙØµÙŠÙ„",p:150},{n:"Ø¹Ù‚Ø§Ù„ ØªÙØµÙŠÙ„ Ù…Ø¬Ø¯ÙˆÙ„",p:250},{n:"Ø®ÙŠØ§Ø·Ø© Ø¹Ù‚Ø§Ù„",p:20},{n:"ØªÙ„Ù…ÙŠØ¹ Ø¹Ù‚Ø§Ù„",p:10},{n:"ÙØ±ÙˆØ© Ø±Ø¬Ø§Ù„ÙŠ",p:100},{n:"ÙØ±ÙˆØ© Ø¨Ø®ÙŠØ§",p:120},{n:"ÙØ±ÙˆØ© Ù†Ø³Ø§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯Ø©",p:130},{n:"Ù‚Ø±ÙˆØ© Ø´Ø¨Ø§Ø¨ÙŠ",p:50},{n:"Ø·Ø§Ø¨Ù‚Ø©",p:10},{n:"Ø·Ø§ÙŠÙ‚Ø© Ø¬Ø²Ø§Ø¦Ø±ÙŠ",p:30},{n:"ØµØ¯Ø±ÙŠØ© Ø±Ø¬Ø§Ù„ÙŠ",p:100},{n:"Ø­Ø¯ÙŠØ§Ù†",p:50},{n:"Ø¨Ø¬Ø§Ù…Ø© Ø±Ø¬Ø§Ù„ÙŠ ÙØ±ÙˆØ©",p:55},{n:"Ø¨Ø¬Ø§Ù…Ø© Ø±Ø¬Ø§Ù„ÙŠ Ø¨Ø¯ÙˆÙ† ÙØ±ÙˆØ©",p:45},{n:"Ø¨Ø¬Ø§Ù…Ø© Ø§Ø·ÙØ§Ù„",p:45},{n:"ÙØ§Ø¦ÙŠÙ„Ø© Ø±Ø¬Ø§Ù„ÙŠ",p:15},{n:"Ø³Ø±ÙˆØ§Ù„ Ø·ÙˆÙŠÙ„",p:20},{n:"Ø·Ù‚Ù… Ù‡Ø¯ÙŠØ©",p:600},{n:"Ù…Ø´Ù„Ø­ Ø´ØªÙˆÙŠ",p:350},{n:"Ù…Ø´Ù„Ø­ ØµÙŠÙÙŠ",p:250},{n:"ØµØ¯Ø±ÙŠØ© Ø´Ø¨Ø§Ø¨ÙŠ",p:50}];
    
    let cart = [];
    let today = new Date().toISOString().split('T')[0];
    let vDate = today;

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function loadDate() { vDate = document.getElementById('hist-date').value || today; refresh(); }
    function goToday() { vDate = today; document.getElementById('hist-date').value = today; refresh(); }

    function saveConf() {
        if(isClosed(vDate)) return;
        let c = {scash: parseFloat(document.getElementById('scash').value)||0, scard: parseFloat(document.getElementById('scard').value)||0};
        localStorage.setItem('conf_'+vDate, JSON.stringify(c)); refresh();
    }

    function isClosed(date) { return localStorage.getItem('closed_'+date) === 'true'; }

    function addP() {
        let n = document.getElementById('pn').value;
        let p = document.getElementById('pp').value;
        if(n && p) {
            let custom = JSON.parse(localStorage.getItem('custom_p')) || [];
            custom.push({n: n, p: parseFloat(p)});
            localStorage.setItem('custom_p', JSON.stringify(custom));
            document.getElementById('pn').value=''; document.getElementById('pp').value='';
            renderP();
        }
    }

    function calcMonth() {
        let month = vDate.substring(0, 7); // ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
        let totalCash = 0; let totalCard = 0;
        
        for (let i = 0; i < localStorage.length; i++) {
            let key = localStorage.key(i);
            if (key.startsWith('db_') && key.includes(month)) {
                let date = key.replace('db_', '');
                let conf = JSON.parse(localStorage.getItem('conf_'+date)) || {scash:0, scard:0};
                let db = JSON.parse(localStorage.getItem(key));
                let s = { 'ÙƒØ§Ø´': 0, 'Ø´Ø¨ÙƒØ©': 0, 'ØªØ­ÙˆÙŠÙ„': 0 };
                db.forEach(op => {
                    if(!op.isRet) {
                        if(op.type==='sale') s[op.m]+=op.a; else s[op.m]-=op.a;
                    }
                });
                totalCash += s['ÙƒØ§Ø´'];
                totalCard += (s['Ø´Ø¨ÙƒØ©'] + s['ØªØ­ÙˆÙŠÙ„']);
            }
        }
        let res = document.getElementById('month-result');
        res.style.display = 'block';
        res.innerHTML = `<strong>Ø¬Ø±Ø¯ Ø´Ù‡Ø± (${month}):</strong><br>ğŸ’µ ÙƒØ§Ø´: ${totalCash} Ø±ÙŠØ§Ù„<br>ğŸ’³ Ø´Ø¨ÙƒØ©: ${totalCard} Ø±ÙŠØ§Ù„<br>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalCash + totalCard} Ø±ÙŠØ§Ù„`;
    }

    function archiveDay() {
        if(confirm(`ØªØ£ÙƒÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ ÙˆØ±Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ÙˆØªØµÙÙŠØ± Ø§Ù„Ø³Ø¬Ù„ØŸ`)) {
            localStorage.setItem('closed_'+vDate, 'true');
            refresh();
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ.");
        }
    }

    function renderP() {
        let custom = JSON.parse(localStorage.getItem('custom_p')) || [];
        document.getElementById('p-list').innerHTML = [...baseP, ...custom].map(x => `
            <div class="p-btn" onclick="addToCart('${x.n}',${x.p})">${x.n}<br><small>${x.p} Ø±ÙŠØ§Ù„</small></div>
        `).join('');
    }

    function addToCart(n,p) { if(isClosed(vDate)) return; cart.push({n,p}); upCart(); }
    function upCart() {
        document.getElementById('cart-items').innerHTML = cart.map(i => `<div>â€¢ ${i.n}</div>`).join('');
        document.getElementById('total').innerText = cart.reduce((s,i)=>s+i.p,0);
    }

    function pay(m) {
        if(isClosed(vDate) || vDate !== today) return alert("Ø§Ù„ÙŠÙˆÙ… Ù…Ø¤Ø±Ø´Ù!");
        if(cart.length===0) return;
        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        db.push({id:Date.now(), t:new Date().toLocaleTimeString('ar-SA'), d:cart.map(c=>c.n).join(', '), a:cart.reduce((s,i)=>s+i.p,0), m:m, type:'sale'});
        localStorage.setItem('db_'+vDate, JSON.stringify(db));
        cart=[]; upCart(); refresh();
    }

    function addEx() {
        if(isClosed(vDate)) return;
        let d = document.getElementById('ed').value; let a = parseFloat(document.getElementById('ea').value);
        if(!d || isNaN(a)) return;
        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        db.push({id:Date.now(), t:"ØµØ±Ù", d:"Ù…ØµØ±ÙˆÙ: "+d, a:a, m:document.getElementById('em').value, type:'ex'});
        localStorage.setItem('db_'+vDate, JSON.stringify(db));
        document.getElementById('ed').value=''; document.getElementById('ea').value=''; refresh();
    }

    function refresh() {
        let closed = isClosed(vDate);
        document.getElementById('closed-label').innerHTML = closed ? '<span class="archive-badge">Ù…Ø¤Ø±Ø´Ù</span>' : "";
        document.getElementById('end-btn').style.display = (closed || vDate !== today) ? "none" : "block";
        document.getElementById('p-card').style.opacity = closed ? "0.4" : "1";
        document.getElementById('cart-card').style.opacity = closed ? "0.4" : "1";

        let conf = JSON.parse(localStorage.getItem('conf_'+vDate)) || {scash:0, scard:0};
        document.getElementById('scash').value = conf.scash;
        document.getElementById('scard').value = conf.scard;
        document.getElementById('day-name').innerText = new Date(vDate).toLocaleDateString('ar-SA', {weekday:'long'});
        document.getElementById('full-date').innerText = vDate;

        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        let h = ''; let s = { 'ÙƒØ§Ø´': conf.scash, 'Ø´Ø¨ÙƒØ©': conf.scard, 'ØªØ­ÙˆÙŠÙ„': 0 };
        
        db.forEach(op => {
            let cls = op.isRet ? 'class="row-ret"' : (op.type==='ex'?'style="color:red"':'');
            h += `<tr ${cls}><td>${op.t}</td><td>${op.d}</td><td>${op.a}</td><td>${op.m}</td>
            <td>${op.isRet || closed ?'-':`<button onclick="retItem(${op.id})">ØªØ±Ø¬ÙŠØ¹</button>`}</td></tr>`;
            if(!op.isRet) { if(op.type==='sale') s[op.m]+=op.a; else s[op.m]-=op.a; }
        });
        document.getElementById('log-body').innerHTML = h;
        document.getElementById('ncash').innerText = s['ÙƒØ§Ø´'];
        document.getElementById('ncard').innerText = (s['Ø´Ø¨ÙƒØ©'] + s['ØªØ­ÙˆÙŠÙ„']);
    }

    function retItem(id) {
        let db = JSON.parse(localStorage.getItem('db_'+vDate)) || [];
        let i = db.find(x=>x.id===id);
        if(i && confirm("Ø¥Ø±Ø¬Ø§Ø¹ØŸ")) { i.isRet=true; localStorage.setItem('db_'+vDate, JSON.stringify(db)); refresh(); }
    }

    function clearSystem() { if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) { localStorage.clear(); location.reload(); } }

    renderP(); refresh();
</script>
</body>
</html>